general:
  whitelist: true
  pipeline_base_name: AndroidApp


compile:
  go_cd_agent_props:
    - java:8
    - android
  stages:
    - stage: GenerateKeys
      jobs:
        - job: Android_Tests
          tasks:
            - task: keytool -genkeypair -v -noprompt -dname "cn=andon, ou=tieto, c=fi" -keystore /etc/andon/ecommerce-release-key.jks -keyalg RSA -keysize 2048 -validity 10000 -alias ecommerce -storepass $STOREPASSWD -keypass $KEYPASSWD
    - stage: CompileAndTest
      jobs:
        - job: Android_Tests
          tasks:
            - task: ./gradlew test -PRELEASE_STORE_PASSWORD=$STOREPASSWD -PRELEASE_KEY_PASSWORD=$KEYPASSWD -Pbuild_id=$GO_PIPELINE_COUNTER
              build_path: .
              run_if_conditions: any
    - stage: BuildAPK
      jobs:
        - job: Android_BuildAPK
          tasks:
            - task: ./gradlew clean build -PRELEASE_KEY_PASSWORD=$KEYPASSWD -PRELEASE_STORE_PASSWORD=$STOREPASSWD -PBUILD_ID=$GO_PIPELINE_COUNTER
              build_path: .
              run_if_conditions: passed
